<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris createWebComponent API Demo</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .demo-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .hero {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .hero h1 {
            margin: 0 0 15px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .hero .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin: 0;
        }
        
        .status-bar {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .demo-section h3 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
        }
        
        .controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .controls button.secondary {
            background: #6c757d;
        }
        
        .controls button.secondary:hover {
            background: #545b62;
        }
        
        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .composition-demo {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #6c757d;
            margin: 20px 0;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        /* Custom component styles will be handled by createWebComponent */
        
        .advanced-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin: 30px 0;
        }
        
        @media (max-width: 768px) {
            .advanced-layout {
                grid-template-columns: 1fr;
            }
            
            .component-grid {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 10px;
            }
            
            .demo-container {
                padding: 20px;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <h1>ðŸ”® Juris createWebComponent API</h1>
        <p class="subtitle">Auto-Registration & Context Injection for WebComponents</p>
    </div>

    <!-- Framework Status -->
    <div class="demo-container">
        <h2>Framework Status</h2>
        <div id="framework-status" class="status-bar">
            <div class="loading"></div> Loading Juris Framework...
        </div>
        <div id="component-stats" class="stats-container" style="display: none;">
            <div class="stat-card">
                <span class="stat-number" id="registered-count">0</span>
                <span class="stat-label">Components Registered</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="instance-count">0</span>
                <span class="stat-label">Active Instances</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="state-updates">0</span>
                <span class="stat-label">State Updates</span>
            </div>
        </div>
    </div>

    <!-- API Features Overview -->
    <div class="demo-container">
        <h2>ðŸš€ createWebComponent API Features</h2>
        <div class="feature-list">
            <div class="feature-item">
                <strong>Auto-Registration</strong><br>
                Automatically registers WebComponents with customElements
            </div>
            <div class="feature-item">
                <strong>Context Injection</strong><br>
                Rich Juris context with component-specific helpers
            </div>
            <div class="feature-item">
                <strong>Reactive State</strong><br>
                Component-scoped state with automatic re-rendering
            </div>
            <div class="feature-item">
                <strong>Attribute Handling</strong><br>
                Automatic attribute observation and parsing
            </div>
            <div class="feature-item">
                <strong>Lifecycle Hooks</strong><br>
                onMount, onUnmount, onAttributeChange support
            </div>
            <div class="feature-item">
                <strong>Event System</strong><br>
                Built-in event emission and handling helpers
            </div>
            <div class="feature-item">
                <strong>Slot Support</strong><br>
                Easy slot access and composition helpers
            </div>
            <div class="feature-item">
                <strong>Error Handling</strong><br>
                Graceful error handling with fallback UI
            </div>
        </div>
    </div>

    <!-- Simple Components Demo -->
    <div class="demo-container">
        <h2>ðŸ“¦ Simple Components</h2>
        <p>Basic components created with the createWebComponent API:</p>
        
        <div class="demo-section">
            <h3>Counter Components</h3>
            <div class="component-grid">
                <demo-counter initial="5" label="Clicks" theme="primary"></demo-counter>
                <demo-counter initial="10" label="Votes" theme="success"></demo-counter>
                <demo-counter initial="0" label="Downloads" theme="info"></demo-counter>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>Button Components</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <demo-button label="Primary" variant="primary"></demo-button>
                <demo-button label="Success" variant="success"></demo-button>
                <demo-button label="Warning" variant="warning"></demo-button>
                <demo-button label="Danger" variant="danger"></demo-button>
            </div>
        </div>
    </div>

    <!-- Composition Demo -->
    <div class="demo-container">
        <h2>ðŸŽ¨ Component Composition</h2>
        <p>Complex components using slot-based composition:</p>
        
        <div class="composition-demo">
            <demo-card title="User Profile" theme="primary">
                <demo-avatar slot="avatar" name="John Doe" size="60"></demo-avatar>
                <div slot="content">
                    <demo-counter initial="42" label="Posts" theme="compact"></demo-counter>
                    <demo-counter initial="128" label="Followers" theme="compact"></demo-counter>
                </div>
                <demo-button slot="actions" label="Follow" variant="primary"></demo-button>
                <demo-button slot="actions" label="Message" variant="secondary"></demo-button>
            </demo-card>
        </div>
        
        <div class="composition-demo">
            <demo-panel title="Dashboard">
                <demo-card slot="main" title="Analytics" theme="success">
                    <demo-metric slot="content" label="Revenue" value="$12,345" trend="up"></demo-metric>
                    <demo-metric slot="content" label="Users" value="1,234" trend="up"></demo-metric>
                </demo-card>
                <demo-card slot="sidebar" title="Quick Actions" theme="info">
                    <demo-button slot="content" label="Add User" variant="success"></demo-button>
                    <demo-button slot="content" label="Export Data" variant="info"></demo-button>
                </demo-card>
            </demo-panel>
        </div>
    </div>

    <!-- Advanced Features -->
    <div class="demo-container">
        <h2>âš¡ Advanced Features</h2>
        
        <div class="advanced-layout">
            <div>
                <h3>Interactive Form</h3>
                <demo-form id="user-form">
                    <demo-input slot="fields" name="username" placeholder="Enter username" required></demo-input>
                    <demo-input slot="fields" name="email" placeholder="Enter email" type="email" required></demo-input>
                    <demo-textarea slot="fields" name="bio" placeholder="Tell us about yourself"></demo-textarea>
                    <demo-button slot="actions" label="Submit" variant="primary"></demo-button>
                    <demo-button slot="actions" label="Reset" variant="secondary"></demo-button>
                </demo-form>
            </div>
            
            <div>
                <h3>Live Data</h3>
                <demo-data-display source="form-data"></demo-data-display>
                
                <h3>Event Log</h3>
                <demo-event-log max-events="10"></demo-event-log>
            </div>
        </div>
    </div>

    <!-- Dynamic Components -->
    <div class="demo-container">
        <h2>ðŸ”„ Dynamic Components</h2>
        <p>Components created and managed dynamically:</p>
        
        <div class="controls">
            <button onclick="addRandomComponent()">Add Random Component</button>
            <button onclick="updateAllCounters()" class="secondary">Update All Counters</button>
            <button onclick="changeThemes()" class="secondary">Change Themes</button>
            <button onclick="clearDynamic()" class="secondary">Clear All</button>
        </div>
        
        <div id="dynamic-container" class="component-grid">
            <!-- Dynamic components will be added here -->
        </div>
    </div>

    <!-- Code Examples -->
    <div class="demo-container">
        <h2>ðŸ’» Code Examples</h2>
        
        <h3>Basic Counter Component</h3>
        <div class="code-example">
// âœ… FINE-GRAINED REACTIVITY - No component re-rendering
juris.createWebComponent('demo-counter', (props, context) => {
    // âœ… Pure render function - NO getState calls here!
    const theme = props.theme || 'primary';
    
    return {
        div: {
            className: `counter counter-${theme}`,
            children: [
                { h4: { text: props.label || 'Counter' } },
                { 
                    div: { 
                        // âœ… Function attribute - only this text updates
                        text: () => context.component.getState('count', props.initial || 0).toString(),
                        className: 'count-display' 
                    } 
                },
                {
                    div: {
                        className: 'counter-controls',
                        children: [
                            { 
                                button: { 
                                    text: 'âˆ’', 
                                    onclick: () => {
                                        // âœ… getState in event handler gets current value
                                        const current = context.component.getState('count', 0);
                                        context.component.setState('count', current - 1);
                                    }
                                } 
                            },
                            { 
                                button: { 
                                    text: '+', 
                                    onclick: () => {
                                        // âœ… getState in event handler gets current value
                                        const current = context.component.getState('count', 0);
                                        context.component.setState('count', current + 1);
                                    }
                                } 
                            }
                        ]
                    }
                }
            ]
        }
    };
}, {
    attributes: ['initial', 'label', 'theme'],
    autoRerender: false, // âœ… Fine-grained reactivity - no component re-render needed
    styles: `/* Component styles */`
});
        </div>
        
        <h3>Advanced Component with Fine-Grained Reactivity</h3>
        <div class="code-example">
// âœ… FINE-GRAINED REACTIVITY - Optimal performance pattern
juris.createWebComponent('demo-advanced', {
    initialState: { mounted: false, interactions: 0 },
    
    render: (props, context) => {
        // âœ… Pure render function - NO getState calls here!
        return {
            div: {
                children: [
                    { h3: { text: 'Advanced Component' } },
                    { 
                        p: { 
                            // âœ… Function attribute - only this text updates
                            text: () => `Mounted: ${context.component.getState('mounted', false)}`
                        } 
                    },
                    { 
                        p: { 
                            // âœ… Function attribute - only this text updates
                            text: () => `Interactions: ${context.component.getState('interactions', 0)}`
                        } 
                    },
                    {
                        button: {
                            text: 'Interact',
                            onclick: () => {
                                // âœ… getState in event handler gets current value
                                const current = context.component.getState('interactions', 0);
                                context.component.setState('interactions', current + 1);
                            }
                        }
                    }
                ]
            }
        };
    },
    
    hooks: {
        onMount: (context) => {
            context.component.setState('mounted', true);
        },
        onUnmount: (context) => {
            console.log('Component unmounted');
        }
    }
}, {
    attributes: ['data-id'],
    autoRerender: false // âœ… Fine-grained reactivity handles all updates
});
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="demo-container">
        <h2>ðŸ“Š Performance Metrics</h2>
        <div id="performance-metrics">
            <div class="stats-container">
                <div class="stat-card">
                    <span class="stat-number" id="render-time">0ms</span>
                    <span class="stat-label">Avg Render Time</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="memory-usage">0MB</span>
                    <span class="stat-label">Memory Usage</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="events-fired">0</span>
                    <span class="stat-label">Events Fired</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Juris Framework -->
    <script src="../src/juris.js"></script>
    
    <script>
        // Global variables for demo
        let juris = null;
        let componentStats = {
            registered: 0,
            instances: 0,
            stateUpdates: 0,
            renderTime: [],
            eventsCount: 0
        };

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeDemo();
        });

        async function initializeDemo() {
            try {
                // Check if Juris is loaded
                if (typeof Juris === 'undefined') {
                    updateStatus('âŒ Juris framework not found. Please check the script path.', 'error');
                    return;
                }

                updateStatus('âœ… Juris framework loaded successfully!', 'success');
                
                // Initialize Juris instance
                juris = new Juris({
                    states: {
                        app: {
                            title: 'createWebComponent Demo',
                            theme: 'primary'
                        },
                        form: {
                            data: {}
                        },
                        events: {
                            log: []
                        }
                    }
                });

                // Create all demo components
                await createDemoComponents();
                
                // Setup global event listeners
                setupEventListeners();
                
                // Start performance monitoring
                startPerformanceMonitoring();
                
                updateStatus('ðŸŽ‰ All components registered and ready!', 'success');
                document.getElementById('component-stats').style.display = 'grid';
                updateComponentStats();
                
            } catch (error) {
                console.error('Demo initialization error:', error);
                updateStatus(`âŒ Initialization failed: ${error.message}`, 'error');
            }
        }

        async function createDemoComponents() {
            // Counter Component - Fine-grained reactivity
            juris.createWebComponent('demo-counter', (props, context) => {
                // âœ… NO getState calls in render function - pure function!
                const theme = props.theme || 'primary';
                
                return {
                    div: {
                        className: `counter-component theme-${theme}`,
                        children: [
                            { 
                                h4: { 
                                    text: props.label || 'Counter',
                                    className: 'counter-label'
                                } 
                            },
                            { 
                                div: { 
                                    // âœ… Fine-grained reactivity: only this text updates
                                    text: () => context.component.getState('count', parseInt(props.initial) || 0).toString(),
                                    className: 'counter-value'
                                } 
                            },
                            {
                                div: {
                                    className: 'counter-controls',
                                    children: [
                                        { 
                                            button: { 
                                                text: 'âˆ’', 
                                                onclick: () => {
                                                    // âœ… getState in event handler gets current value
                                                    const currentCount = context.component.getState('count', parseInt(props.initial) || 0);
                                                    context.component.setState('count', currentCount - 1);
                                                    logEvent('counter-decrement', { count: currentCount - 1 });
                                                }
                                            } 
                                        },
                                        { 
                                            button: { 
                                                text: '+', 
                                                onclick: () => {
                                                    // âœ… getState in event handler gets current value
                                                    const currentCount = context.component.getState('count', parseInt(props.initial) || 0);
                                                    context.component.setState('count', currentCount + 1);
                                                    logEvent('counter-increment', { count: currentCount + 1 });
                                                }
                                            } 
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['initial', 'label', 'theme'],
                autoRerender: false, // âœ… Fine-grained reactivity, no component re-render needed
                attributes: ['initial', 'label', 'theme'],
                styles: `
                    :host {
                        display: block;
                        margin: 10px;
                    }
                    .counter-component {
                        border: 2px solid #ddd;
                        border-radius: 8px;
                        padding: 20px;
                        text-align: center;
                        background: white;
                        transition: all 0.3s ease;
                    }
                    .counter-component:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    }
                    .theme-primary { border-color: #007bff; }
                    .theme-success { border-color: #28a745; }
                    .theme-info { border-color: #17a2b8; }
                    .theme-compact { padding: 10px; }
                    .counter-label {
                        margin: 0 0 10px 0;
                        color: #495057;
                        font-size: 14px;
                    }
                    .counter-value {
                        font-size: 24px;
                        font-weight: bold;
                        margin: 10px 0;
                        color: #007bff;
                    }
                    .counter-controls button {
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        margin: 0 5px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-weight: bold;
                    }
                    .counter-controls button:hover {
                        background: #0056b3;
                    }
                `
            });
            componentStats.registered++;

            // Button Component - Fine-grained reactivity
            juris.createWebComponent('demo-button', (props, context) => {
                // âœ… NO getState calls in render function
                const variant = props.variant || 'primary';
                
                const variants = {
                    primary: '#007bff',
                    success: '#28a745',
                    warning: '#ffc107',
                    danger: '#dc3545',
                    secondary: '#6c757d',
                    info: '#17a2b8'
                };
                
                return {
                    button: {
                        // âœ… Fine-grained reactivity: only text updates when clicked state changes
                        text: () => {
                            const clicked = context.component.getState('clicked', false);
                            return clicked ? `âœ“ ${props.label}` : props.label || 'Button';
                        },
                        className: `demo-btn btn-${variant}`,
                        onclick: () => {
                            // âœ… getState in event handler gets current value
                            const currentClicked = context.component.getState('clicked', false);
                            context.component.setState('clicked', !currentClicked);
                            context.component.emit('demo-button-click', { 
                                label: props.label, 
                                variant,
                                timestamp: Date.now()
                            });
                            logEvent('button-click', { label: props.label, variant });
                        }
                    }
                };
            }, {
                attributes: ['label', 'variant'],
                autoRerender: false, // âœ… Fine-grained reactivity, no component re-render needed
                attributes: ['label', 'variant'],
                styles: `
                    .demo-btn {
                        padding: 10px 20px;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 500;
                        transition: all 0.2s ease;
                        margin: 5px;
                    }
                    .btn-primary { background: #007bff; color: white; }
                    .btn-success { background: #28a745; color: white; }
                    .btn-warning { background: #ffc107; color: black; }
                    .btn-danger { background: #dc3545; color: white; }
                    .btn-secondary { background: #6c757d; color: white; }
                    .btn-info { background: #17a2b8; color: white; }
                    .demo-btn:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    }
                `
            });
            componentStats.registered++;

            // Card Component
            juris.createWebComponent('demo-card', (props, context) => {
                const title = props.title || 'Card';
                const theme = props.theme || 'default';
                
                const themes = {
                    primary: { bg: '#007bff', text: 'white' },
                    success: { bg: '#28a745', text: 'white' },
                    info: { bg: '#17a2b8', text: 'white' },
                    default: { bg: '#f8f9fa', text: '#333' }
                };
                
                const colors = themes[theme] || themes.default;
                
                return {
                    div: {
                        className: 'demo-card',
                        style: {
                            background: colors.bg,
                            color: colors.text
                        },
                        children: [
                            {
                                div: {
                                    className: 'card-header',
                                    children: [
                                        { slot: { name: 'avatar' } },
                                        { span: { text: title, className: 'card-title' } }
                                    ]
                                }
                            },
                            {
                                div: {
                                    className: 'card-content',
                                    children: [{ slot: { name: 'content' } }]
                                }
                            },
                            {
                                div: {
                                    className: 'card-actions',
                                    children: [{ slot: { name: 'actions' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['title', 'theme'],
                styles: `
                    .demo-card {
                        border-radius: 8px;
                        overflow: hidden;
                        margin: 10px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    .card-header {
                        padding: 15px;
                        border-bottom: 1px solid rgba(255,255,255,0.2);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    .card-title {
                        font-weight: bold;
                        font-size: 16px;
                    }
                    .card-content {
                        padding: 15px;
                    }
                    .card-actions {
                        padding: 10px 15px;
                        border-top: 1px solid rgba(255,255,255,0.2);
                        display: flex;
                        gap: 10px;
                        flex-wrap: wrap;
                    }
                `
            });
            componentStats.registered++;

            // Avatar Component
            juris.createWebComponent('demo-avatar', (props, context) => {
                const name = props.name || 'User';
                const size = props.size || '40';
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                return {
                    div: {
                        className: 'demo-avatar',
                        style: {
                            width: size + 'px',
                            height: size + 'px',
                            fontSize: Math.floor(size / 3) + 'px'
                        },
                        children: [
                            { span: { text: initials } }
                        ]
                    }
                };
            }, {
                attributes: ['name', 'size'],
                styles: `
                    .demo-avatar {
                        border-radius: 50%;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: bold;
                        flex-shrink: 0;
                    }
                `
            });
            componentStats.registered++;

            // Panel Component
            juris.createWebComponent('demo-panel', (props, context) => {
                const title = props.title || 'Panel';
                
                return {
                    div: {
                        className: 'demo-panel',
                        children: [
                            {
                                div: {
                                    className: 'panel-header',
                                    text: title
                                }
                            },
                            {
                                div: {
                                    className: 'panel-body',
                                    children: [
                                        {
                                            div: {
                                                className: 'panel-main',
                                                children: [{ slot: { name: 'main' } }]
                                            }
                                        },
                                        {
                                            div: {
                                                className: 'panel-sidebar',
                                                children: [{ slot: { name: 'sidebar' } }]
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['title'],
                styles: `
                    .demo-panel {
                        border: 2px solid #007bff;
                        border-radius: 8px;
                        background: white;
                        overflow: hidden;
                    }
                    .panel-header {
                        background: #007bff;
                        color: white;
                        padding: 15px;
                        font-weight: bold;
                        font-size: 16px;
                    }
                    .panel-body {
                        display: grid;
                        grid-template-columns: 2fr 1fr;
                        gap: 20px;
                        padding: 20px;
                    }
                    @media (max-width: 768px) {
                        .panel-body {
                            grid-template-columns: 1fr;
                        }
                    }
                `
            });
            componentStats.registered++;

            // Metric Component
            juris.createWebComponent('demo-metric', (props, context) => {
                const label = props.label || 'Metric';
                const value = props.value || '0';
                const trend = props.trend || 'neutral';
                
                const trendIcons = {
                    up: 'â†—ï¸',
                    down: 'â†˜ï¸',
                    neutral: 'âž¡ï¸'
                };
                
                const trendColors = {
                    up: '#28a745',
                    down: '#dc3545',
                    neutral: '#6c757d'
                };
                
                return {
                    div: {
                        className: 'demo-metric',
                        children: [
                            { 
                                div: { 
                                    text: label, 
                                    className: 'metric-label' 
                                } 
                            },
                            { 
                                div: { 
                                    text: value, 
                                    className: 'metric-value' 
                                } 
                            },
                            {
                                div: {
                                    className: 'metric-trend',
                                    style: { color: trendColors[trend] },
                                    text: trendIcons[trend]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['label', 'value', 'trend'],
                styles: `
                    .demo-metric {
                        padding: 15px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        background: white;
                        margin: 5px 0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .metric-label {
                        font-size: 14px;
                        color: #6c757d;
                    }
                    .metric-value {
                        font-size: 18px;
                        font-weight: bold;
                        color: #495057;
                    }
                    .metric-trend {
                        font-size: 16px;
                    }
                `
            });
            componentStats.registered++;

            // Form Component
            juris.createWebComponent('demo-form', (props, context) => {
                return {
                    form: {
                        className: 'demo-form',
                        onsubmit: (e) => {
                            e.preventDefault();
                            const formData = new FormData(e.target);
                            const data = Object.fromEntries(formData.entries());
                            juris.setState('form.data', data);
                            logEvent('form-submit', data);
                            context.component.emit('demo-form-submit', { data });
                        },
                        children: [
                            {
                                div: {
                                    className: 'form-fields',
                                    children: [{ slot: { name: 'fields' } }]
                                }
                            },
                            {
                                div: {
                                    className: 'form-actions',
                                    children: [{ slot: { name: 'actions' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                styles: `
                    .demo-form {
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        border: 1px solid #dee2e6;
                    }
                    .form-fields {
                        margin-bottom: 20px;
                    }
                    .form-actions {
                        display: flex;
                        gap: 10px;
                        flex-wrap: wrap;
                    }
                `
            });
            componentStats.registered++;

            // Input Component
            juris.createWebComponent('demo-input', (props, context) => {
                const value = context.component.getState('value', '');
                const name = props.name || 'input';
                const type = props.type || 'text';
                const placeholder = props.placeholder || '';
                const required = props.hasOwnProperty('required');
                
                return {
                    div: {
                        className: 'demo-input-group',
                        children: [
                            {
                                input: {
                                    type: type,
                                    name: name,
                                    defaultValue: value, // â† Changed from 'value' to 'defaultValue'
                                    placeholder: placeholder,
                                    required: required,
                                    className: 'demo-input',
                                    oninput: (e) => {
                                        // Update state without triggering re-render
                                        context.component.setState('value', e.target.value);
                                        logEvent('input-change', { name, value: e.target.value });
                                    }
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['name', 'type', 'placeholder', 'required'],
                autoRerender: false, // â† Disable automatic re-rendering
                rerenderOnAttributeChange: true, // â† Still re-render on attribute changes
                styles: `
                    .demo-input-group {
                        margin: 10px 0;
                    }
                    .demo-input {
                        width: 100%;
                        padding: 10px;
                        border: 1px solid #ced4da;
                        border-radius: 4px;
                        font-size: 14px;
                    }
                    .demo-input:focus {
                        outline: none;
                        border-color: #007bff;
                        box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
                    }
                `
            });
            componentStats.registered++;

            // Textarea Component
            juris.createWebComponent('demo-textarea', (props, context) => {
                const value = context.component.getState('value', '');
                const name = props.name || 'textarea';
                const placeholder = props.placeholder || '';
                
                return {
                    div: {
                        className: 'demo-textarea-group',
                        children: [
                            {
                                textarea: {
                                    name: name,
                                    defaultValue: value, // â† Changed from 'value' to 'defaultValue'
                                    placeholder: placeholder,
                                    className: 'demo-textarea',
                                    rows: '3',
                                    oninput: (e) => {
                                        // Update state without triggering re-render
                                        context.component.setState('value', e.target.value);
                                        logEvent('textarea-change', { name, value: e.target.value });
                                    }
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['name', 'placeholder'],
                autoRerender: false, // â† Disable automatic re-rendering
                rerenderOnAttributeChange: true, // â† Still re-render on attribute changes
                styles: `
                    .demo-textarea-group {
                        margin: 10px 0;
                    }
                    .demo-textarea {
                        width: 100%;
                        padding: 10px;
                        border: 1px solid #ced4da;
                        border-radius: 4px;
                        font-size: 14px;
                        font-family: inherit;
                        resize: vertical;
                    }
                    .demo-textarea:focus {
                        outline: none;
                        border-color: #007bff;
                        box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
                    }
                `
            });
            componentStats.registered++;

            // Data Display Component - Fine-grained reactivity
            juris.createWebComponent('demo-data-display', (props, context) => {
                // âœ… NO getState calls in render function
                const source = props.source || 'form-data';
                
                return {
                    div: {
                        className: 'demo-data-display',
                        children: [
                            { h4: { text: 'Live Data' } },
                            {
                                pre: {
                                    // âœ… Fine-grained reactivity: only this pre content updates
                                    text: () => {
                                        const data = juris.getState(`form.data`, {});
                                        return JSON.stringify(data, null, 2);
                                    },
                                    className: 'data-content'
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['source'],
                autoRerender: false, // âœ… Fine-grained reactivity, no component re-render needed
                attributes: ['source'],
                styles: `
                    .demo-data-display {
                        background: #f8f9fa;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        padding: 15px;
                    }
                    .demo-data-display h4 {
                        margin-top: 0;
                        color: #495057;
                    }
                    .data-content {
                        background: white;
                        padding: 10px;
                        border-radius: 4px;
                        font-size: 12px;
                        margin: 0;
                        overflow-x: auto;
                    }
                `
            });
            componentStats.registered++;

            // Event Log Component - Fine-grained reactivity
            juris.createWebComponent('demo-event-log', (props, context) => {
                // âœ… NO getState calls in render function
                const maxEvents = parseInt(props['max-events']) || 5;
                
                return {
                    div: {
                        className: 'demo-event-log',
                        children: [
                            { h4: { text: 'Event Log' } },
                            {
                                div: {
                                    className: 'event-list',
                                    // âœ… Fine-grained reactivity: only this div content updates
                                    children: () => {
                                        const events = juris.getState('events.log', []).slice(-maxEvents);
                                        
                                        return events.length > 0 ? events.map(event => ({
                                            div: {
                                                className: 'event-item',
                                                children: [
                                                    { 
                                                        span: { 
                                                            text: event.type, 
                                                            className: 'event-type' 
                                                        } 
                                                    },
                                                    { 
                                                        span: { 
                                                            text: new Date(event.timestamp).toLocaleTimeString(), 
                                                            className: 'event-time' 
                                                        } 
                                                    }
                                                ]
                                            }
                                        })) : [{ div: { text: 'No events yet', className: 'no-events' } }];
                                    }
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['max-events'],
                autoRerender: false, // âœ… Fine-grained reactivity, no component re-render needed
                attributes: ['max-events'],
                styles: `
                    .demo-event-log {
                        background: #f8f9fa;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        padding: 15px;
                        max-height: 300px;
                        overflow-y: auto;
                    }
                    .demo-event-log h4 {
                        margin-top: 0;
                        color: #495057;
                    }
                    .event-item {
                        background: white;
                        padding: 8px 12px;
                        margin: 5px 0;
                        border-radius: 4px;
                        border-left: 3px solid #007bff;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .event-type {
                        font-weight: 500;
                        color: #495057;
                    }
                    .event-time {
                        font-size: 12px;
                        color: #6c757d;
                    }
                    .no-events {
                        text-align: center;
                        color: #6c757d;
                        font-style: italic;
                        padding: 20px;
                    }
                `
            });
            componentStats.registered++;
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('framework-status');
            statusEl.innerHTML = message;
            statusEl.className = `status-bar status-${type}`;
        }

        function updateComponentStats() {
            document.getElementById('registered-count').textContent = componentStats.registered;
            document.getElementById('instance-count').textContent = componentStats.instances;
            document.getElementById('state-updates').textContent = componentStats.stateUpdates;
        }

        function setupEventListeners() {
            // Listen for custom events
            document.addEventListener('demo-button-click', (e) => {
                logEvent('button-click', e.detail);
            });

            document.addEventListener('demo-form-submit', (e) => {
                logEvent('form-submit', e.detail);
            });

            // Monitor component creation
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === Node.ELEMENT_NODE && node.tagName && node.tagName.startsWith('DEMO-')) {
                            componentStats.instances++;
                            updateComponentStats();
                        }
                    });
                    
                    mutation.removedNodes.forEach((node) => {
                        if (node.nodeType === Node.ELEMENT_NODE && node.tagName && node.tagName.startsWith('DEMO-')) {
                            componentStats.instances--;
                            updateComponentStats();
                        }
                    });
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }

        function logEvent(type, data) {
            const events = juris.getState('events.log', []);
            events.push({
                type,
                data,
                timestamp: Date.now()
            });
            juris.setState('events.log', events);
            componentStats.stateUpdates++;
            componentStats.eventsCount++;
            updateComponentStats();
        }

        function startPerformanceMonitoring() {
            setInterval(() => {
                // Update performance metrics
                const avgRenderTime = componentStats.renderTime.length > 0 
                    ? (componentStats.renderTime.reduce((a, b) => a + b, 0) / componentStats.renderTime.length).toFixed(1)
                    : '0';
                
                document.getElementById('render-time').textContent = avgRenderTime + 'ms';
                document.getElementById('events-fired').textContent = componentStats.eventsCount;
                
                if (performance.memory) {
                    const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                    document.getElementById('memory-usage').textContent = memoryMB + 'MB';
                }
            }, 1000);
        }

        // Demo control functions
        function addRandomComponent() {
            const container = document.getElementById('dynamic-container');
            const components = ['demo-counter', 'demo-button', 'demo-metric'];
            const themes = ['primary', 'success', 'info', 'warning'];
            
            const randomComponent = components[Math.floor(Math.random() * components.length)];
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            
            const element = document.createElement(randomComponent);
            
            if (randomComponent === 'demo-counter') {
                element.setAttribute('initial', Math.floor(Math.random() * 100));
                element.setAttribute('label', 'Random Counter');
                element.setAttribute('theme', randomTheme);
            } else if (randomComponent === 'demo-button') {
                element.setAttribute('label', 'Dynamic Button');
                element.setAttribute('variant', randomTheme);
            } else if (randomComponent === 'demo-metric') {
                element.setAttribute('label', 'Random Metric');
                element.setAttribute('value', Math.floor(Math.random() * 1000));
                element.setAttribute('trend', ['up', 'down', 'neutral'][Math.floor(Math.random() * 3)]);
            }
            
            container.appendChild(element);
            logEvent('component-added', { type: randomComponent, theme: randomTheme });
        }

        function updateAllCounters() {
            const counters = document.querySelectorAll('demo-counter');
            counters.forEach(counter => {
                const randomValue = Math.floor(Math.random() * 100);
                counter.updateComponentState({ count: randomValue });
            });
            logEvent('counters-updated', { count: counters.length });
        }

        function changeThemes() {
            const themes = ['primary', 'success', 'info', 'warning', 'danger'];
            const cards = document.querySelectorAll('demo-card');
            const buttons = document.querySelectorAll('demo-button');
            
            cards.forEach(card => {
                const randomTheme = themes[Math.floor(Math.random() * themes.length)];
                card.setAttribute('theme', randomTheme);
            });
            
            buttons.forEach(button => {
                const randomTheme = themes[Math.floor(Math.random() * themes.length)];
                button.setAttribute('variant', randomTheme);
            });
            
            logEvent('themes-changed', { cards: cards.length, buttons: buttons.length });
        }

        function clearDynamic() {
            const container = document.getElementById('dynamic-container');
            const count = container.children.length;
            container.innerHTML = '';
            logEvent('dynamic-cleared', { removed: count });
        }
    </script>
</body>
</html>